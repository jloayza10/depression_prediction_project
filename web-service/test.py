import predict
import numpy as np
from numpy import nan
import requests

user = {'steps_awake_mean': 1623.2857142857142,
        'sleep_asleep_weekday_mean': 63.0,#635.1818181818181
        'sleep_asleep_weekend_mean': 62.0,#628.0
        'sleep_in_bed_weekday_mean': 64.0,#642.6363636363636
        'sleep_in_bed_weekend_mean': 63.0,#637.5
        'sleep_ratio_asleep_in_bed_weekday_mean': 0.9899829072226788,
        'sleep_ratio_asleep_in_bed_weekend_mean': 0.9851912059155878,
        'sleep_in_bed_iqr': np.nan,
        'sleep_asleep_iqr': np.nan,
        'sleep_ratio_asleep_in_bed_iqr': np.nan,
        'steps_mvpa_iqr': np.nan,
        'steps_lpa_iqr': np.nan,
        'steps_awake_sum_iqr': 2062.75,
        'sleep_main_start_hour_adj_median': 22.0,
        'sleep_main_start_hour_adj_iqr': np.nan,
        'sleep_main_start_hour_adj_range': 4.0,
        'sleep__hypersomnia_count_': 2,
        'sleep__hyposomnia_count_': 0,
        'steps__active_day_count_': 0,
        'steps__sedentary_day_count_': 7,
        'sleep__main_start_hour_adj__score': 0.45764781662594967,
        'sleep__main_start_hour_adj__intercept': -1.7182839140877093,
        'sleep__main_start_hour_adj__coeff': 0.15836941484587067,
        'steps__awake__sum__score': 0.028107950497963663,
        'steps__awake__sum__intercept': -1.195480417791993,
        'steps__awake__sum__coeff': -0.009476055314708447,
        'steps__mvpa__sum__score': np.nan,
        'steps__mvpa__sum__intercept': np.nan,
        'steps__mvpa__sum__coeff': np.nan,
        'steps__light_activity__sum__score': 0.224515360604567,
        'steps__light_activity__sum__intercept': -0.6695555236654173,
        'steps__light_activity__sum__coeff': -0.02301157833965633,
        'steps__rolling_6_sum__max__score': 0.02534476034354416,
        'steps__rolling_6_sum__max__intercept': -1.2460412457249193,
        'steps__rolling_6_sum__max__coeff': -0.022651818026044834,
        'steps__streaks__countDistinct__score': 0.005814771880434,
        'steps__streaks__countDistinct__intercept': -1.9237332947552799,
        'steps__streaks__countDistinct__coeff': -0.008162887116695057,
        'steps__not_moving__sum__score': 0.020454034820909794,
        'steps__not_moving__sum__intercept': -1.0383838427147674,
        'steps__not_moving__sum__coeff': 0.017407967556059025,
        'sleep__nap_count__score': 1.0,
        'sleep__nap_count__intercept': -0.3877730250398764,
        'sleep__nap_count__coeff': 0.0,
        'sleep__total_asleep_minutes__score': 0.11328589310696091,
        'sleep__total_asleep_minutes__intercept': 2.0056761883751806,
        'sleep__total_asleep_minutes__coeff': -0.07795512199714129,
        'sleep__main_efficiency__score': 0.12739547038327526,
        'sleep__main_efficiency__intercept': 0.7138424174042439,
        'sleep__main_efficiency__coeff': 0.005155899981561898,
        'sleep__awake__sum__score': 0.04078171928353991,
        'sleep__awake__sum__intercept': -0.6358076145484295,
        'sleep__awake__sum__coeff': -0.0044813641345869595,
        'sleep__total_in_bed_minutes__score': 0.11211364672022328,
        'sleep__total_in_bed_minutes__intercept': 1.6705881449447884,
        'sleep__total_in_bed_minutes__coeff': -0.07524527929447405,
        'sleep__awake_regions__countDistinct__score': 0.012639771355696827,
        'sleep__awake_regions__countDistinct__intercept': -1.3226799573671746,
        'sleep__awake_regions__countDistinct__coeff': -0.010587025738453004,
        'sleep_ratio_asleep_in_bed__score': 0.012619769757740817,
        'sleep_ratio_asleep_in_bed__intercept': 0.7471221303424257,
        'sleep_ratio_asleep_in_bed__coeff': 0.001505008063765974,
        'sleep__main_start_hour_adj__score_': np.nan,
        'sleep__main_start_hour_adj__intercept_': np.nan,
        'sleep__main_start_hour_adj__coeff_': np.nan,
        'steps__awake__sum__score_': 0.0007796705873003296,
        'steps__awake__sum__intercept_': -1.2824893579442629,
        'steps__awake__sum__coeff_': -0.0031120953774362026,
        'steps__mvpa__sum__score_': np.nan,
        'steps__mvpa__sum__intercept_': np.nan,
        'steps__mvpa__sum__coeff_': np.nan,
        'steps__light_activity__sum__score_': np.nan,
        'steps__light_activity__sum__intercept_': np.nan,
        'steps__light_activity__sum__coeff_': np.nan,
        'steps__rolling_6_sum__max__score_': 0.13570903048740157,
        'steps__rolling_6_sum__max__intercept_': -1.834417390186992,
        'steps__rolling_6_sum__max__coeff_': 0.09953796747579613,
        'steps__streaks__countDistinct__score_': 0.01819100555836295,
        'steps__streaks__countDistinct__intercept_': -1.89995830739488,
        'steps__streaks__countDistinct__coeff_': -0.029999990707717653,
        'steps__not_moving__sum__score_': 0.033894398611685306,
        'steps__not_moving__sum__intercept_': -0.7292041391539185,
        'steps__not_moving__sum__coeff_': -0.047363458366946116,
        'sleep__nap_count__score_': np.nan,
        'sleep__nap_count__intercept_': np.nan,
        'sleep__nap_count__coeff_': np.nan,
        'sleep__total_asleep_minutes__score_': np.nan,
        'sleep__total_asleep_minutes__intercept_': np.nan,
        'sleep__total_asleep_minutes__coeff_': np.nan,
        'sleep__main_efficiency__score_': np.nan,
        'sleep__main_efficiency__intercept_': np.nan,
        'sleep__main_efficiency__coeff_': np.nan,
        'sleep__awake__sum__score_': np.nan,
        'sleep__awake__sum__intercept_': np.nan,
        'sleep__awake__sum__coeff_': np.nan,
        'sleep__total_in_bed_minutes__score_': np.nan,
        'sleep__total_in_bed_minutes__intercept_': np.nan,
        'sleep__total_in_bed_minutes__coeff_': np.nan,
        'sleep__awake_regions__countDistinct__score_': np.nan,
        'sleep__awake_regions__countDistinct__intercept_': np.nan,
        'sleep__awake_regions__countDistinct__coeff_': np.nan,
        'sleep_ratio_asleep_in_bed__score_': np.nan,
        'sleep_ratio_asleep_in_bed__intercept_': np.nan,
        'sleep_ratio_asleep_in_bed__coeff_': np.nan,
        'steps_mvpa_sum_recent': 2.0,
        'sleep_asleep_mean_recent': 607.0,
        'sleep_in_bed_mean_recent': 615.5,
        'sleep_ratio_asleep_in_bed_mean_recent': 0.9867552914790632,
        'steps_lpa_sum_recent': 10.0,
        'steps_rolling_6_median_recent': 11.0,#114.0
        'steps_rolling_6_max_recent': 10.0,#392.0
        'sex': 0,
        'race_white': True,
        'race_black': False,
        'race_hispanic': False,
        'race_asian': False,
        'race_other': False,
        'birthyear': 1981,
        'educ': 0.0,#5
        'height': 68.5,
        'weight': 238.0,
        'bmi': 35.657520379348924,
        'pregnant': 0.0,#0
        'birth': 1.0,#0
        'trauma': 1.0,#0
        'insurance': 0.0,#1
        'money': 4.0,#1
        'money_assistance': 0.0,#0
        'household': 0.0,#1
        'comorbid_cancer': 1.0,#0
        'comorbid_diabetes_typ1': 0.0,#0
        'comorbid_diabetes_typ2': 1.0,#0
        'comorbid_gout': 1.0,
        'comorbid_migraines': 1.0,
        'comorbid_ms': 1.0,#0
        'comorbid_osteoporosis': 1.0,#0
        'num_migraine_days': 5.0,#0
        'meds_migraine': 0.0,
        'med_start': 1,#0
        'med_stop': 0,
        'med_dose': 0,
        'nonmed_start': 1,#0
        'nonmed_stop': 0,
        'life_meditation': 0,
        'life_stress': 0,
        'med_nonmed_dnu': 0,
        'life_activity_eating': 0,
        'life_red_stop_alcoh': 0,
        'comorbid_neuropathic': 1.0,#0
        'comorbid_arthritis': 1.0,
        'id_month': '2197_6'}


        # 'phq9_score_start': 16.0,
        # 'phq9_score_end': 24.0,
        # 'phq9_cat_end': 4.0,
        # 'phq9_cat_start': 3.0
        # df raw index 422


user2 = {'steps_awake_mean': 10000.2857142857142,
        'sleep_asleep_weekday_mean': 630.0,#635.1818181818181
        'sleep_asleep_weekend_mean': 620.0,#628.0
        'sleep_in_bed_weekday_mean': 640.0,#642.6363636363636
        'sleep_in_bed_weekend_mean': 630.0,#637.5
        'sleep_ratio_asleep_in_bed_weekday_mean': 0.9899829072226788,
        'sleep_ratio_asleep_in_bed_weekend_mean': 0.9851912059155878,
        'sleep_in_bed_iqr':'',
        'sleep_asleep_iqr': '',
        'sleep_ratio_asleep_in_bed_iqr': '',
        'steps_mvpa_iqr': '',
        'steps_lpa_iqr': '',
        'steps_awake_sum_iqr': 2062.75,
        'sleep_main_start_hour_adj_median': 22.0,
        'sleep_main_start_hour_adj_iqr': '',
        'sleep_main_start_hour_adj_range': 4.0,
        'sleep__hypersomnia_count_': 0,
        'sleep__hyposomnia_count_': 0,
        'steps__active_day_count_': 7,
        'steps__sedentary_day_count_': 0,
        'sleep__main_start_hour_adj__score': 0.45764781662594967,
        'sleep__main_start_hour_adj__intercept': -1.7182839140877093,
        'sleep__main_start_hour_adj__coeff': 0.15836941484587067,
        'steps__awake__sum__score': 0.028107950497963663,
        'steps__awake__sum__intercept': -1.195480417791993,
        'steps__awake__sum__coeff': -0.009476055314708447,
        'steps__mvpa__sum__score': '',
        'steps__mvpa__sum__intercept':'' ,
        'steps__mvpa__sum__coeff': '',
        'steps__light_activity__sum__score': 0.224515360604567,
        'steps__light_activity__sum__intercept': -0.6695555236654173,
        'steps__light_activity__sum__coeff': -0.02301157833965633,
        'steps__rolling_6_sum__max__score': 0.02534476034354416,
        'steps__rolling_6_sum__max__intercept': -1.2460412457249193,
        'steps__rolling_6_sum__max__coeff': -0.022651818026044834,
        'steps__streaks__countDistinct__score': 0.005814771880434,
        'steps__streaks__countDistinct__intercept': -1.9237332947552799,
        'steps__streaks__countDistinct__coeff': -0.008162887116695057,
        'steps__not_moving__sum__score': 0.020454034820909794,
        'steps__not_moving__sum__intercept': -1.0383838427147674,
        'steps__not_moving__sum__coeff': 0.017407967556059025,
        'sleep__nap_count__score': 1.0,
        'sleep__nap_count__intercept': -0.3877730250398764,
        'sleep__nap_count__coeff': 0.0,
        'sleep__total_asleep_minutes__score': 0.11328589310696091,
        'sleep__total_asleep_minutes__intercept': 2.0056761883751806,
        'sleep__total_asleep_minutes__coeff': -0.07795512199714129,
        'sleep__main_efficiency__score': 0.12739547038327526,
        'sleep__main_efficiency__intercept': 0.7138424174042439,
        'sleep__main_efficiency__coeff': 0.005155899981561898,
        'sleep__awake__sum__score': 0.04078171928353991,
        'sleep__awake__sum__intercept': -0.6358076145484295,
        'sleep__awake__sum__coeff': -0.0044813641345869595,
        'sleep__total_in_bed_minutes__score': 0.11211364672022328,
        'sleep__total_in_bed_minutes__intercept': 1.6705881449447884,
        'sleep__total_in_bed_minutes__coeff': -0.07524527929447405,
        'sleep__awake_regions__countDistinct__score': 0.012639771355696827,
        'sleep__awake_regions__countDistinct__intercept': -1.3226799573671746,
        'sleep__awake_regions__countDistinct__coeff': -0.010587025738453004,
        'sleep_ratio_asleep_in_bed__score': 0.012619769757740817,
        'sleep_ratio_asleep_in_bed__intercept': 0.7471221303424257,
        'sleep_ratio_asleep_in_bed__coeff': 0.001505008063765974,
        'sleep__main_start_hour_adj__score_': '',
        'sleep__main_start_hour_adj__intercept_': '',
        'sleep__main_start_hour_adj__coeff_': '',
        'steps__awake__sum__score_': 0.0007796705873003296,
        'steps__awake__sum__intercept_': -1.2824893579442629,
        'steps__awake__sum__coeff_': -0.0031120953774362026,
        'steps__mvpa__sum__score_': '',
        'steps__mvpa__sum__intercept_': '',
        'steps__mvpa__sum__coeff_': '',
        'steps__light_activity__sum__score_': '',
        'steps__light_activity__sum__intercept_': '',
        'steps__light_activity__sum__coeff_': '',
        'steps__rolling_6_sum__max__score_': 0.13570903048740157,
        'steps__rolling_6_sum__max__intercept_': -1.834417390186992,
        'steps__rolling_6_sum__max__coeff_': 0.09953796747579613,
        'steps__streaks__countDistinct__score_': 0.01819100555836295,
        'steps__streaks__countDistinct__intercept_': -1.89995830739488,
        'steps__streaks__countDistinct__coeff_': -0.029999990707717653,
        'steps__not_moving__sum__score_': 0.033894398611685306,
        'steps__not_moving__sum__intercept_': -0.7292041391539185,
        'steps__not_moving__sum__coeff_': -0.047363458366946116,
        'sleep__nap_count__score_': '',
        'sleep__nap_count__intercept_': '',
        'sleep__nap_count__coeff_': '',
        'sleep__total_asleep_minutes__score_': '',
        'sleep__total_asleep_minutes__intercept_': '',
        'sleep__total_asleep_minutes__coeff_': '',
        'sleep__main_efficiency__score_': '',
        'sleep__main_efficiency__intercept_': '',
        'sleep__main_efficiency__coeff_': '',
        'sleep__awake__sum__score_': '',
        'sleep__awake__sum__intercept_': '',
        'sleep__awake__sum__coeff_': '',
        'sleep__total_in_bed_minutes__score_': '',
        'sleep__total_in_bed_minutes__intercept_': '',
        'sleep__total_in_bed_minutes__coeff_': '',
        'sleep__awake_regions__countDistinct__score_': '',
        'sleep__awake_regions__countDistinct__intercept_': '',
        'sleep__awake_regions__countDistinct__coeff_': '',
        'sleep_ratio_asleep_in_bed__score_': '',
        'sleep_ratio_asleep_in_bed__intercept_': '',
        'sleep_ratio_asleep_in_bed__coeff_': '',
        'steps_mvpa_sum_recent': 2.0,
        'sleep_asleep_mean_recent': 60.0,
        'sleep_in_bed_mean_recent': 61.5,
        'sleep_ratio_asleep_in_bed_mean_recent': 0.9867552914790632,
        'steps_lpa_sum_recent': 10.0,
        'steps_rolling_6_median_recent': 11.0,#114.0
        'steps_rolling_6_max_recent': 10.0,#392.0
        'sex': 1,
        'race_white': False,
        'race_black': False,
        'race_hispanic': False,
        'race_asian': False,
        'race_other': True,
        'birthyear': 1990,
        'educ': 5.0,#5
        'height': 68.5,
        'weight': 170.0,
        'bmi': 26.6,
        'pregnant': 0.0,#0
        'birth': 0.0,#0
        'trauma': 0.0,#0
        'insurance': 1.0,#1
        'money': 0.0,#1
        'money_assistance': 0.0,#0
        'household': 0.0,#1
        'comorbid_cancer': 0.0,#0
        'comorbid_diabetes_typ1': 0.0,#0
        'comorbid_diabetes_typ2': 0.0,#0
        'comorbid_gout': 0.0,
        'comorbid_migraines': 0.0,
        'comorbid_ms': 0.0,#0
        'comorbid_osteoporosis': 0.0,#0
        'num_migraine_days': 0.0,#0
        'meds_migraine': 0.0,
        'med_start': 0,#0
        'med_stop': 0,
        'med_dose': 0,
        'nonmed_start': 1,#0
        'nonmed_stop': 0,
        'life_meditation': 0,
        'life_stress': 0,
        'med_nonmed_dnu': 0,
        'life_activity_eating': 0,
        'life_red_stop_alcoh': 0,
        'comorbid_neuropathic': 0.0,#0
        'comorbid_arthritis': 0.0,
        'id_month': '2197_6'}
# print(f'----------------------------Reading data from user with len: {len(user2)}----------------------------------------------')
# df = predict.read_data(user2)
# #print(f'-----------binning__money_neg_charac_sum^2: {df["binning__money_neg_charac_sum^2"].values}, Shape of df: {df.shape}-------------------------------')
# print(df)
# pred = predict.predict(df)
# print(pred)


url = 'http://127.0.0.1:9696/predict'
response = requests.post(url, json=user2)
response.raise_for_status()
print('Finished requests post')
print(response.json())